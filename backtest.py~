import sys, getopt
import data_parser as dp
from os.path import isfile, join

def main(argv):
	
### read filename, startdate, enddate from argument:	
	filename = ''
	slippage = 10
	sharpe_threshold = 0
	try:
		opts, args = getopt.getopt(argv, 'hi:l:r:s:e:')
	except getopt.GetoptError:
		print 'backtest.py -i filename -l slippage -r sharpe_threshold -s startdate -e enddate'
		sys.exit(2)
	
	for opt, arg in opts:
		if opt == '-h':
			print 'backtest.py -i filename -l slippage -r sharpe_threshold -s startdate -e enddate'
			sys.exit(1)
		elif opt == '-i':
			filename = arg
		elif opt == '-l':
			slippage = arg
		elif opt == '-r':
			sharpe_threshold = arg
		elif opt == '-s':
			startdate = arg
		elif opt == '-e':
			enddate = arg
			
### Backtest starts:
	entries = [1, 1.5, 2, 2.5, 3, 3.5, 4]
	exits = [0.5, 0.75, 1.0]
	print 'File name is: ', filename
	for entry in entries:
		for exit in exits:
			try:
				(sr, profit, num_trades) = dp.spread(filename).EE_Sharpe_Ratio(entry, exit, int(slippage))
				if sr > float(sharpe_threshold):
					print (entry, entry*exit), '\t', ("%6.2f" % sr,\
											profit, num_trades,\
											"%6.2f" % (profit/num_trades*2)), '\t', get_ratio(
			except:
				print "file IO error"
				print 'backtest.py -i filename -l slippage -r sharpe_threshold -s startdate -e enddate' 
				sys.exit(2)
				
		
	
if __name__ == "__main__":
	main(sys.argv[1:])
